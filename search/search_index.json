{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SARKV6","text":"<p>SARK is a PBX workbench for the popular Asterisk PBX.   The current release should be installed onto a host Ubuntu 22.04 server image.   </p> <p>The Documentation in these pages cover how to install the packages which make up SARK.</p>"},{"location":"Installation/","title":"Installation","text":"<p>V6 can be installed onto X86 or ARM platforms. Only 64-bit architectures are supported. It will happily install on bare-metal or in virtual environments and has additional support for AWS EC2 instances. SARK is developed on Ubuntu and it should ideally be installed onto that distro but you may be able to install it onto other \"debian-like\" distros (YMMV).</p> <ul> <li>It will work with most modern browsers.</li> <li>It will NOT work on any browser that doesn't support jQuery or has it disabled.</li> <li>It will NOT work on any browser that does not support HTML5 or CSS3.</li> </ul>"},{"location":"Installation/#before-you-begin","title":"Before you begin","text":"<ul> <li>V6.2 is designed to run as an appliance and must not be installed onto a multi-purpose system that has other software already installed on it. If you try, you will likely break both the existing systems and SARK. You must begin with an Ubuntu 22.04 minimal install which contains nothing but an SSH server.</li> </ul>"},{"location":"Installation/#installing-the-package-manager","title":"Installing the package manager","text":"<p>SARK uses the packagecloud repo.   Here are the steps you need to prepare to use it.</p> <pre><code>sudo apt update\nsudo apt upgrade\ncurl -s https://packagecloud.io/install/repositories/aelintra/SARK/script.deb.sh | sudo bash\n</code></pre>"},{"location":"Installation/#sark-62-installation","title":"SARK 6.2 Installation","text":"<p>The latest SARK 6.2 will auto-install on Ubuntu 22.04 LTS (Jammy Jellyfish).  It may install on other debian-like releases, but you will need to grab the deb packages from GitHub and install them manually (https://github.com/aelintra/sail6).</p>"},{"location":"Installation/#installing-a-mail-agent","title":"Installing a Mail Agent","text":"<p>If this is a new install, you should install a mail agent. SARK has on-board support for a lightweight mail agent called ssmtp. If you install it, then SARK will provide a tab in the networking section for you to configure it. Install it now (so that SARK can set the correct permissions) ...:</p> <pre><code>sudo apt install ssmtp\n</code></pre> <p>Note: Ubuntu creates the ssmtp directory with secure access permissions. You must fix it by doing:</p> <pre><code>sudo chmod +x /etc/ssmtp\n</code></pre>"},{"location":"Installation/#install-mysqlmariadb","title":"Install mySQL/Mariadb","text":"<p>The SARK install uses an SQL database to process call statistics.  It can be either mysql or mariadb but SARK does not specify which, so you'll need to decide. Install it now ...:  </p> <pre><code>sudo apt install mysql-server\n</code></pre> <p>OR</p> <p><pre><code>sudo apt install mariadb-server\n</code></pre> N.B. DO NOT run mysql_secure_installation yet!!   The SARK install will automatically build the CDR Database for you but it needs access to mysql root without a password.   Once the installation is done, you should then run mysql_secure_installation to secure your DB instance (see below).</p>"},{"location":"Installation/#install-the-sark-packages","title":"Install the SARK packages","text":"<pre><code>sudo apt install sail\n</code></pre> <p>The install will take a good few minutes depending upon the speed of the donor box and your internet link. During the install, you may be asked to enter an admin password for LDAP (make a note of it, you'll need it later). It will also ask about dumpcap but just take the default (No) and let the install run to its conclusion.</p>"},{"location":"Installation/#link-the-hpe-according-to-your-architecture","title":"link the HPE according to your architecture","text":"<p>SARK ships with a compiled C code switching engine called sarkhpe.  There are two versions; one for regular X86-64 type architectures and one for the increasingly popular ARM64.</p> <p>If you don't know which arch you are running do this...</p> <pre><code>uname -m\n</code></pre> <p>It will return something like X86-64 (Intel/AMD) or aarch64 (ARM).  Once you have decided which architecture you have, proceed as follows..</p> <pre><code>cd /usr/share/asterisk/agi-bin\nls -l\n-rwxr-xr-x 1 root root  19525 Dec 14  2023 kwakeup\n-rwxr-xr-x 1 root root 530944 Mar 12 19:00 sarkhpe_amd64\n-rwxr-xr-x 1 root root 545528 Mar 12 19:00 sarkhpe_arm64\n</code></pre> <p>As you can see, the two HPE modules each have a suffix denoting the arch for which they were compiled. Choose the one you want by creating a soft link to it...</p> <pre><code>sudo ln -s sarkhpe_amd64 sarkhpe\n</code></pre> <p>Now the file list should show the link you created  this...</p> <pre><code>ls -l \n-rwxr-xr-x 1 root root  19525 Dec 14  2023 kwakeup\nlrwxrwxrwx 1 root root     13 Mar 13 18:47 sarkhpe -&gt; sarkhpe_amd64\n-rwxr-xr-x 1 root root 530944 Mar 12 19:00 sarkhpe_amd64\n-rwxr-xr-x 1 root root 545528 Mar 12 19:00 sarkhpe_arm64\n</code></pre>"},{"location":"Installation/#reboot","title":"Reboot","text":"<p>Now reboot your new PBX <pre><code>sudo reboot\n</code></pre></p>"},{"location":"Installation/#install-asterisk-extra-sounds-package","title":"Install Asterisk Extra Sounds Package","text":"<p>SARK requires the Asterisk extra sounds package. If you want UK English, there is a deb on the repo:</p> <pre><code>sudo apt install ast-en-gb-gpl-gsm-sounds\n</code></pre> <p>If you want \"Alison\" (US American), there is no deb available for this but it's pretty easy to install. At the Linux CLI, do the following:</p> <pre><code>cd /usr/share/asterisk/sounds\nsudo wget http://downloads.asterisk.org/pub/telephony/sounds/asterisk-extra-sounds-en-gsm-current.tar.gz\nsudo tar xvfz asterisk-extra-sounds-en-gsm-current.tar.gz\nsudo rm asterisk-extra-sounds-en-gsm-current.tar.gz\n</code></pre>"},{"location":"Installation/#check-and-secure-your-mysqlmariadb-database","title":"Check and secure your mysql/mariadb database","text":"<p>To check the mysql/mariadb is good you can do the following:-</p> <pre><code>sudo mysql -u root\n</code></pre> <p>check the cdr database has been created:- <pre><code>show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| asterisk           |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.01 sec)\n\nuse asterisk\ndescribe cdr;\n+-------------+--------------+------+-----+-----------+-------------------+\n| Field       | Type         | Null | Key | Default   | Extra             |\n+-------------+--------------+------+-----+-----------+-------------------+\n| calldate    | datetime     | NO   | MUL | curdate() | DEFAULT_GENERATED |\n| clid        | varchar(80)  | NO   |     |           |                   |\n| src         | varchar(80)  | NO   |     |           |                   |\n| dst         | varchar(80)  | NO   | MUL |           |                   |\n| dcontext    | varchar(80)  | NO   |     |           |                   |\n| channel     | varchar(80)  | NO   |     |           |                   |\n| dstchannel  | varchar(80)  | NO   |     |           |                   |\n| lastapp     | varchar(80)  | NO   |     |           |                   |\n| lastdata    | varchar(80)  | NO   |     |           |                   |\n| duration    | int          | NO   |     | 0         |                   |\n| billsec     | int          | NO   |     | 0         |                   |\n| disposition | varchar(45)  | NO   |     |           |                   |\n| amaflags    | int          | NO   |     | 0         |                   |\n| accountcode | varchar(20)  | NO   | MUL |           |                   |\n| userfield   | varchar(255) | NO   |     |           |                   |\n+-------------+--------------+------+-----+-----------+-------------------+\n15 rows in set (0.00 sec)\n</code></pre></p> <p>If you get the same output as above, you're golden.</p> <p>Now you can run the secure script for your mysql or maria database</p> <p><pre><code>sudo mysql_secure_installation\n</code></pre> Follow the script prompts.</p>"},{"location":"Installation/#next-steps","title":"Next steps","text":"<p>If you were running a previous version of SARK on your browser then you will need to clear your broswer cache or open an incognito/private window before proceeding. If you don't, you'll get odd-looking output as the cached jQuery code fights with the new V6 output.</p> <p>Your SARK app will be at <code>https://your.server.ip.address</code></p> <p>Default login credentials will be...</p> <ul> <li>UID: admin</li> <li>PWD: sarkadmin</li> </ul> <p>If this is a brand new install, the SARK browser application will force you to change your password on first login. This will change BOTH the browser AND linux root passwords.</p>"},{"location":"LDAP/","title":"LDAP","text":""},{"location":"LDAP/#ldap","title":"LDAP","text":"<p>If you wish to use SARK's LDAP support to provide directory lookups to your phones, proceed as follows:</p>"},{"location":"LDAP/#check-the-ldap-base-name-base-dn","title":"Check the LDAP Base Name (Base DN)","text":"<p>You can check by running slapcat as follows:</p> <pre><code>sudo slapcat\n</code></pre> <pre><code>dn: dc=nodomain\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no: nodomain\ndc: nodomain\n</code></pre> <p>The base name appears in the first line of output. In the above example, it is \"dc=nodomain\". We've used \"nodomain\" as an example because you'll likely see it a lot, particularly when you are spinning up LXC instances and the like. It just means that LDAP couldn't find the FQDN, probably because it wasn't set. It's no big deal, you can just go ahead and use dc=nodomain if you like. In any event, you should enter whatever YOUR base name is into the Globals=&gt;LDAP panel along with the LDAP password you chose during the install. If \"dc=nodomain\" bothers you, then you'll need to enter a domain name in SARK, issue a commit and then do a reconfigure for slapd (the LDAP daemon):</p> <pre><code>sudo dpkg-reconfigure slapd\n</code></pre> <p>This will allow it to have another look.</p>"},{"location":"LDAP/#adding-the-contacts-ou","title":"Adding the Contacts OU","text":"<p>Now we need to add an organizationalUnit (ou) for the address book. If you are already a whiz with LDAP, then just go ahead and do it, using the base name. If you don't know LDAP, then proceed as follows:</p> <p>You will find a file on your SARK box at <code>/opt/sark/cache/ldapcontactou.ldif</code>:</p> <pre><code>dn: ou=contacts,dc=sark,dc=aelintra,dc=com\nobjectClass: organizationalUnit\nobjectClass: top\nou: contacts\n</code></pre> <p>Without getting into the details (you can read about LDAP elsewhere); in the first line of the file is the name of the organizationalUnit we want to create. In our example, it is \"contacts\". The remainder of the line (dc=sark,dc=aelintra,dc=com) is the base name we discussed earlier. You must edit the file to make the file match your base name from the slapcat you did a couple of steps back. If, for example, you have a base name of <code>dc=splodge,dc=soap,dc=com</code> then you should make your file look like this:</p> <pre><code>dn: ou=contacts,dc=splodge,dc=soap,dc=com\nobjectClass: organizationalUnit\nobjectClass: top\nou: contacts\n</code></pre> <p>Ok, let's add it. We are going to use the LDAP slapadd utility, which is old-fashioned nowadays, but easy to use:</p> <pre><code>sudo service slapd stop\nsudo slapadd -l /opt/sark/cache/ldapcontactou.ldif\nsudo service slapd start\n</code></pre> <p>Refresh your browser and navigate to SARK. You should see a \"Directory\" option when you click on the \"Settings\" drop-down. In this page, you can add and modify your telephone book entries or upload a vCard file you have exported from Google contacts or whatever. You can also have your phones browse your contacts if you have SIP phones which are LDAP aware (many are). You'll need to add a couple of entries to your SARK firewall for TCP ports 389 and 686 (restrict them to net:$LAN) to allow the phones to query the database - don't forget to restart the firewall.</p>"},{"location":"LDAP/#set-up-your-phones-to-use-ldap","title":"Set Up Your Phones to Use LDAP","text":"<p>Most major SIP Phone types can use LDAP; however, the implementation varies from type to type. Snom, Panasonic (KX-HDV), Yealink, and Fanvil all support LDAP and have on-board provisioning already set up for openLDAP on SARK. Cisco small business phones (SPA) support LDAP and Provu have a section on their website showing how to set them up here. Polycom phone set-up is more complex (isn't it always?), however, there is good documentation provided by Polycom so you should be able to get it running with a little work although we don't show it here. Gigaset professional (N series) phones support LDAP and there is documentation on their website.</p>"},{"location":"featureKeys/","title":"Keypad Operations","text":""},{"location":"featureKeys/#transfers","title":"Transfers","text":"Key Sequence data function Availability Comment # NULL BLIND XFER In-line xfer *2# {extension}} ATT XFER inline Attended xfer XFER-&gt;*5 NULL Park Park a call into the parking lot *8 NULL Pickup Pickup call *8 call group} Pickup Pickup call from a specific call group Hold none Hold Endpoints with hold feature Place call on hold call and play MOH XFER none XFER Endpoints with XFER feature Place call on hold call and play MOH Message Light/Mail Icon none Pick up voicemail All VoIP endpoints with MWI feature Connect to Voicemail _70X none Parked call pickup internal * {extension} dial or transfer to an extension's Voicemail internal Useful to transfer a call directly to an extension's voicemail box ** {extension} dial or transfer to an extension's mini-queue internal Camp-on miniqueue feature; needs to be turned on for the tenant"},{"location":"featureKeys/#dnd-and-diverts","title":"DND and Diverts","text":"Key Sequence data function Availability Comment *18* none DND Activation internal Deflect all direct calls to voicemail *19* none DND Deactivation internal *20* none DND Toggle internal Flip from OFF to ON or ON to OFF *21* none or extension Call Forward Immediate (CFIM) internal Use with no extension to turn off *22* none or extension Call Forward Busy (CFBS) internal Use with no extension to turn off *23* none Clear ALL callforwards internal *27* extension Follow Me internal Direct a remote extension's calls to the local station - requests your vmail passwd"},{"location":"featureKeys/#timers","title":"Timers","text":"Key Sequence data function Availability Comment *30* none Set Timers to Automatic (default) internal *31* none Set Timers to CLOSED internal *31* none Set Timers to OPEN internal"},{"location":"featureKeys/#voicemail","title":"Voicemail","text":"Key Sequence data function Availability Comment *50* none Retrieve Voicemail for the current extension internal The attedant will ask for the vmail password *51* none Retrieve Voicemail for the another extension internal The attedant will ask for the extension number and its vmail password"},{"location":"featureKeys/#miscellaneous","title":"Miscellaneous","text":"Key Sequence data function Availability Comment *26* 99 Set ringtime before failing to vmail internal if no ring delay is specified the ring will never timeout *52* none echo test internal Used to test audio quality *55* none Time and Date internal *56* none Speak the extension number internal"},{"location":"featureKeys/#system-greetings","title":"System Greetings","text":"Key Sequence data function Availability Comment *60* 9999 Record a new system greeting internal greetings MUST be 4 digits long *61* 9999 Listen to a greeting internal"},{"location":"featureKeys/#acd-agents-queues-and-supervision","title":"ACD - Agents, Queues and supervision","text":"Key Sequence data function Availability Comment *63* Agent ID Pause Agent internal Agent will be given no new calls while paused *64* Agent ID Resume Agent internal Agent will resume receiving calls *65* Agent ID Agent Login internal Agent will begin receiving calls after login *66* Agent ID Agent Logout internal Agent will cease receiving calls after logout *67* extension ChanSpy(Whisper) internal Supervisor coaching *68* extension ChanSpy internal Supervisor coaching"},{"location":"featureKeys/#nanp-vertical-service-code-compatibility","title":"NANP Vertical Service Code Compatibility","text":"Key Sequence data function Availability Comment *60 none Time and Date internal *65 none Speak the extension number internal *72 extension Call Forward Immediate internal *73 none Cancel Call Forward Immediate internal *77 nnnn 4-digit greeting number Record a system greeting internal *78 none Do Not Disturb internal *79 none Cancel Do Not Disturb internal *90 (extension) Call Forward Busy internal *91 none Cancel Call Forward Busy internal *97 Local Voicemail internal connect to voicemail from own station *98 extension Remote Voicemail internal/external Connect to voicemail from another station"}]}